# Оптимизация работы программы с помошью AVX инструкций на примере заполнения множества Мандельброта

## Введение

Главной целью данного проекта явлеяется оптимизация рендеринга множества Мандельброта. Главной особенностью данного множества является то, что для отрисовки необходимо пересчитывать каждую точку по отделиности **ПОДПРАВИТЬ**.

## Установка программы

Для установки и сборки моей программы пропишите в удобной для вас папке следующие команды:
```
git clone git@github.com:Carvalanga/MandelbrotSetOptimization.git
make
```
Если вы хотите пересобрать проект вам необходимо напишите `make cleanObj`, а затем снова `make`.

> Примечание: программа устанавливается в режиме float, что укоряет прорисовку, но уменьшает детализацию множества. Если вы хотите большую детализацию, откройте Makefile и во второй строке напишите MODE := double.

## Использование программы

Моя программа поддеживает два режима работы:
- Графичесикй
- Режим тестирования

Для запуска в графическом режиме напишите `./mandelbrot`

Управление в данном режиме представлено в таблице:
| Клавиша        | Действие                    |
|:--------------:|:---------------------------:|
| Стрелка вверх  | Камера наверх               |
| Стрелка вниз   | Камера вниз                 |
| Стрелка влево  | Камера влево                |
| Стрелка вправо | Камера вправо               |
| Z              | Приблизить                  |
| X              | Отдалить                    |
| Enter          | Переключить режим отрисовки |

Для запуска в режиме тестирования вам необходимо написать `./mandelbrot --test N`, где вместо N необходимо написать число измерений (рекомендую не ставить число измерений больше 30, так как это займет слишком много времени). После вычислений программа создаст три файла с измеренными данными, а также файл `graph.png` в котором будет подробная информация о тестировании. Чтобы удалить все новые созданные файлы можете написать `make cleanData`.

## Теоретическая справка

![image](https://github.com/user-attachments/assets/527682fa-81eb-4a00-ab10-87efac07f370)

Мно́жество Мандельбро́та — множество точек c на комплексной плоскости, для которых рекуррентное соотношение $z_{n+1} = z_n^2 + c$, при $z_0 = 0$ задаёт ограниченную последовательность. Иными словами, это множество таких **c**, для которых существует такое действительное **R**, что неравенство $|z_n| < R$ выполняется при всех натуральных **n**. Определение и название принадлежат французскому математику Адриену Дуади, в честь математика Бенуа Мандельброта[1].

Множество Мандельброта является одним из самых известных фракталов, в том числе за пределами математики, благодаря своим цветным визуализациям. Его фрагменты не строго подобны исходному множеству, но при многократном увеличении определённые части всё больше похожи друг на друга.

Для плоскости XoY можно определить каждую последующую точку следующим соотношением:

$x_{n+1} = x_n^2 - y_n^2 + x_0$

$y_{n+1} = 2{x_n}{y_n} + y_0$

## Оптимизация
Проблема отрисовки данного множества заключатеся в том, что программа каждый кадр рассчитывает последовательности точек и проверяет, выходят ли они за определенную границу. Для точек, не принадлежащих множеству, колиество итераций мало, поэтому программа быстро справляется с задачей. Однако точки, принадлежащие множеству, проходят достаточно большое число проверок из-за чего программа замедляется.

Мною было проведено несколько этапов оптимизации
1. Оптимизация с помощью intrinsics из AVX/AVX2
2. Оптимизация путем развертки цикла и использованием массивов векторов AVX.

Погрешность измерений будем рассчитывать по следующей формуле:

$\sigma_ {x_{cр}} = \sqrt \frac {\Sigma_ {i=1} ^ n(x_{i} - x_{ср}) ^ 2}{n}$

Систематическая погрешность много меньше, чем случайная, поэтому учитывать ее в своей работе я не стал.

## Измерения
Ниже приведены результаты измерений для 30 заполенений множества Мандельброта в разрешении 1920 x 1072 при разных значений флага оптимизации:

-O0:

![image](https://github.com/user-attachments/assets/5c6c8570-efaa-4d51-89c7-e3c61d9b4dc4)

-O1:

![image](https://github.com/user-attachments/assets/b20ca395-09ec-4715-bede-fdcce71cf156)

-O2:

![image](https://github.com/user-attachments/assets/e9898298-fa84-4c3c-acc2-478851d2bd12)

-03:

![image](https://github.com/user-attachments/assets/cdadfe97-f491-4692-80f7-57d61e1ab796)

-Ofast:

![image](https://github.com/user-attachments/assets/442dfe39-a1f4-41c6-89a4-42337d57a0b2)

## Выводы

С помощью avx и комплияторных оптимизаций мне удалось добиться прироста производительности примерно в 12 раз в сравненеии с примитивной версией программы с флагом -О3 и прироста в 28 раз в сравнении с примитиной версией без каких либо компиляторных оптимизаций. При этом оптимизация с флагом -О2 оказалась эффективнее, чем -О3 и -Ofast
